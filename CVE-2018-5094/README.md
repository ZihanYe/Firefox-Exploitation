# CVE-2018-5094

A heap buffer overflow vulnerability may occur in WebAssembly when "shrinkElements" is called followed by garbage collection on memory that is now uninitialized. This results in a potentially exploitable crash. This vulnerability affects Firefox < 58.

Type: heap overflow

FF version: 57.0 (ASAN build)

Build configuration:
	- --enable-address-sanitizer
	- --disable-jemalloc
	- --disable-crashreporter
	- --disable-elf-hack
	- --enable-debug-symbols
	- --disable-install-strip
	- --enable-optimize=-O2
	- --disable-debug
	- --enable-valgrind
	- --disable-profiling
	- --disable-tests
	- --enable-gczeal


running  ```./mach run --debug --disable-e10s --ion-eager --fuzzing-safe ../CVE-2018-5094/crash.html```

gives:

=================================================================
==3034==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020003616c0 at pc 0x7fffe613256b bp 0x7ffffffe7910 sp 0x7ffffffe7900
READ of size 8 at 0x6020003616c0 thread T0
    #0 0x7fffe613256a in js::WasmTableObject::getImpl(JSContext*, JS::CallArgs const&) /home/clover/firefox-57.0/js/src/wasm/WasmJS.cpp:1720
    #1 0x7fffe61328ea in CallNonGenericMethod<IsTable, js::WasmTableObject::getImpl> /home/clover/firefox-57.0/objdir-ff-asan/dist/include/js/CallNonGenericMethod.h:100
    #2 0x7fffe61328ea in js::WasmTableObject::get(JSContext*, unsigned int, JS::Value*) /home/clover/firefox-57.0/js/src/wasm/WasmJS.cpp:1742

    
Reference:
[1] https://bugzilla.mozilla.org/show_bug.cgi?id=1415291