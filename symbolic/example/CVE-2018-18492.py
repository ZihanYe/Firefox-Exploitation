import executor

# e = executor.Executor("/home/ug16zy2/angr-dev/symbolic/tests/CVE-2018-18492/core.19261", stop_when_active_more_than=600)
# e = executor.Executor("/home/ug16zy2/angr-dev/symbolic/tests/CVE-2018-18492/core.19261", log_interval=100, log_file='out.log', debug=False)
# e.run(uaf_object_base=0x00005569804e00c0, uaf_object_size=280, context_end=0x00007f6825c02e7f)
# 21352
# e.run(uaf_object_base=0x00005654bd2dbe30, uaf_object_size=280, context_end=0x00007f0bc9ac0e7f)

# 19261 !!!1
# e = executor.Executor("/home/ug16zy2/angr-dev/tmp/symbolic/tests/CVE-2018-18492/core.19261", log_interval=50, log_file='CVE-2018-18492_2', debug=False, stop_when_write_primtive_found=1)
# e.run(uaf_object_base=0x563f3d81f200, uaf_object_size=280, context_end=0x00007fbb8e699e7f)

# core
# e = executor.Executor("/nas/ug16zy2/core", log_interval=100, log_file='out.log', debug=False)
# e.run(uaf_object_base=0x561408707030, uaf_object_size=280, context_end=0x00007f38bb5e4b5a)

# core.30041
libc_funcs = [(0x7f21035fdc30, 'libc','realloc'),
                (0x00007f21035fc950, 'libc','free'),
                (0x00007f21035fc070, 'libc','malloc'),
                (0x7f21035c9dc0, 'libc','fprintf'),
                (0x00007f2103620460, 'libc', 'memcpy'),
                (0x00007f2103603c10, 'libc', 'memcmp'),
                (0x7f7ab1fb3620, 'libc', 'memset')
                ]
# e = executor.Executor("/nas/ug16zy2/firefox-63.0.3/core.30041", stop_when_control_hijack_found=True, stop_when_write_primtive_found=True, log_interval=50, log_file='out.log', debug=False), lib_call_hook=libc_funcs)
# e.run(uaf_object_base=0x424d0f0, uaf_object_size=280, context_end=0x00007f20f02bab66)

# with /nas/ug16zy2/firefox-63.0.3/objdir-ff-dbg_s/
# e = executor.Executor("/nas/ug16zy2/firefox-63.0.3/core.22706", log_interval=50, log_file='CVE-2018-18492_1', debug=False, stop_when_write_primtive_found=1)
# e.run(uaf_object_base=0x55d20028ea80, uaf_object_size=280, context_end=0x00007f8b60733b66)

# with /nas/ug16zy2/firefox-63.0.3/objdir-ff-dbg/
# e = executor.Executor("/nas/ug16zy2/firefox-63.0.3/core.25993", log_interval=50, log_file='CVE-2018-18492_1', debug=False, stop_when_write_primtive_found=1)
# e.run(uaf_object_base=0x56444f196490, uaf_object_size=280, context_end=0x00007f2dbea39b12)

# with /home/ug16zy2/firefox-63.0.3/objdir-ff-dbg_s/
libc_funcs = [(0x7f21035fdc30, 'libc','realloc'),
                (0x00007f7ab1f99950, 'libc','free'),
                (0x00007f7ab1f99070, 'libc','malloc'),
                (0x00007f7ab1f66dc0, 'libc','fprintf'),
                (0x00007f7ab1fbd460, 'libc', 'memcpy'),
                (0x00007f7ab1fa0c10, 'libc', 'memcmp'),
                (0x00007f7ab1fa0d40, 'libc', 'memset'),
                 # (0x00007f7ab1f9fc70, 'libc', 'strlen'),
		(0x7f7ab1fb3620, 'libc', 'strlen'),
		]

do_nothing=[0x7f7ab1cef3b6,0x7f7ab1cec729, 0x00007f7a9b875321] # PR_GetThreadPrivate, PR_GetCurrentThread, AssertActivityIsLegal
avoids = [0x7f7a9ba03590, 0x7f7a9d437ffa, 0x7f7a9b72a9b0, 0x000055d371d3deb1, 0x000055d371d0faf1] # MOZ_ReportAssertionFailure,MOZ_CrashOOL@plt,MOZ_CrashOOL ,abort()

e = executor.Executor("/home/ug16zy2/firefox-63.0.3/core.19261", avoids=avoids, do_nothing_instr = do_nothing, lib_call_hook=libc_funcs, log_interval=50, log_file='CVE-2018-18492_6', debug=False) #, stop_when_write_primtive_found=1)
e.run(uaf_object_base=0x55d37532e9d0, uaf_object_size=280, context_end=0x00007f7a9e8cdad6)

# e = executor.Executor("/nas/ug16zy2/corefiles/core18492_3", log_interval=50, log_file='CVE-2018-18492_3', debug=False, stop_when_write_primtive_found=1)
# e.run(uaf_object_base=0x562e0b6fc1e0, uaf_object_size=280, context_end=0x00007f657fac3ad6)
