import angr

class SymCallProc(angr.SimProcedure):
    NO_RET = False
    IS_FUNCTION = True

    def run(self):
        print('hooking symbolic call')
        # Fork two sucessors:
        # one is returning unconstrainted symbolic value (assuming we can control whatever it returns)
        # one is returning a pointer to unconstrained memory (assuming we cannot control, but the return value is a pointer)

        # return a value of size 64 bits
        try:
            name = self.state.record.get_return_symbol()
            ret_symbol = self.state.solver.BVS(name, size = 64, explicit_name=True)
            self.state.record.do_symbolic_call(ret_symbol)
            self.ret(expr=ret_symbol)
        except:
            print("symbolic call SimProcedure failed unexpectedly")
