# CVE-2018-18492

heap-use-after-free in mozilla::dom::HTMLOptionsCollection_Binding::add

Type: use-after-free

Version of Firefox I tried: 63.0.3 (ASAN build + fuzzing enabled)

(see mozconfig file for configuration)

## Crash:

run ```./mach run --debug --disable-e10s``` and open crash.html

gives:

=================================================================
==45094==ERROR: AddressSanitizer: heap-use-after-free on address 0x6120000b5b68 at pc 0x7fffd8716e84 bp 0x7ffffffda940 sp 0x7ffffffda930
READ of size 8 at 0x6120000b5b68 thread T0
    #0 0x7fffd8716e83 in nsINode::IsDocument() const /home/clover/firefox-63.0.3/dom/base/nsINode.h:418
    #1 0x7fffd8716e83 in IsAllowedAsChild /home/clover/firefox-63.0.3/dom/base/nsINode.cpp:2120
    #2 0x7fffd883ac48 in nsINode::EnsurePreInsertionValidity2(bool, nsINode&, nsINode*, mozilla::ErrorResult&) /home/clover/firefox-63.0.3/dom/base/nsINode.cpp:2269
    #3 0x7fffd883ac48 in nsINode::ReplaceOrInsertBefore(bool, nsINode*, nsINode*, mozilla::ErrorResult&) /home/clover/firefox-63.0.3/dom/base/nsINode.cpp:2335
    #4 0x7fffdbc27869 in nsINode::InsertBefore(nsINode&, nsINode*, mozilla::ErrorResult&) /home/clover/firefox-63.0.3/dom/base/nsINode.h:1798


## Exploitation


Reference:

[1] https://bugzilla.mozilla.org/show_bug.cgi?id=1499861
