mk_add_options MOZ_OBJDIR=@TOPSRCDIR@/objdir-ff-asan

export LLVM_CONFIG="/usr/bin/llvm-config"

# Enable ASan specific code and build workarounds
ac_add_options --enable-address-sanitizer

export CC=/usr/bin/clang
export CXX=/usr/bin/clang++

# Add ASan to our compiler flags
export CFLAGS="-fsanitize=address -Dxmalloc=myxmalloc -fPIC"
export CXXFLAGS="-fsanitize=address -Dxmalloc=myxmalloc -fPIC"

export LDFLAGS="-fsanitize=address"

# These three are required by ASan
ac_add_options --disable-jemalloc
ac_add_options --disable-crashreporter
ac_add_options --disable-elf-hack

# Keep symbols to symbolize ASan traces later
export MOZ_DEBUG_SYMBOLS=1
ac_add_options --enable-debug-symbols
ac_add_options --disable-install-strip

ac_add_options --enable-optimize=-O2
ac_add_options --disable-debug

ac_add_options --disable-profiling
ac_add_options --enable-tests

# fuzzing
ac_add_options --enable-fuzzing
