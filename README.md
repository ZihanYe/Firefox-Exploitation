# Firefox-Exploitation
Exploit Firefox Vulnerabilities

:spider::spider::spider::spider::spider::spider:

## Setup:
OS: Ubuntu 64-bit

### 1. Get Firefox source code 
from https://ftp.mozilla.org/pub/firefox/releases/ , or alternatively run 
```
  hg clone https://hg.mozilla.org/releases/mozilla-release/ firefox63 -u <rev>
```
where <rev> is the changeset hash found in https://hg.mozilla.org/releases/mozilla-release/tags,
and if switching to another changeset:
```
  Hg update -r <rev>
```
  
### 2. Configuration
    - normal debug build:
    ```
          echo "# for debug" > mozconfig
          echo "ac_add_options --disable-optimize" >> mozconfig
          echo "ac_add_options --enable-debug" >> mozconfig
    ```
    - ASAN build:
          see https://developer.mozilla.org/en-US/docs/Mozilla/Testing/Firefox_and_Address_Sanitizer
          
### 3. Build
   ```
          ./mach bootstrap
          ./mach build
   ```
   
#### :hammer_and_pick: Troubleshooting:
I have run into many errors especially when trying to build older versions of Firefox. Below are solutions I found:

- Could not find gconf-2.0
  sudo apt-get install gconf-2.0
  sudo apt-get install -y libgconf2-dev
  
- configure error with sed 4.3: sed: character class syntax is [[:space:]], not [:space:]
  - open build/autoconf/icu.m4
  - modify manually according to https://bugzilla.mozilla.org/attachment.cgi?id=8825307&action=diff
  
- anything with rustc/cargo version: 
  It is likely because we are using newer version of rustc now and we need to downgrade it.
  - Find rustc version used at the time of the older version (https://wiki.mozilla.org/Rust_Update_Policy_for_Firefox)
  - run ```$ ~/.cargo/bin/rustup self uninstall```
  - install:  
    ```
      $ curl https://sh.rustup.rs -sSf | sh
       Choose:
         2) Custom Installation
            default host triple <enter>
            default toolchain  1.22.1
            Modify PATH variable? (y/n)  n
       Then Choose:
         1) Proceed with installation (default)
    ```
- ASAN build reports gcc compilation error:
error: inlining failed in call to always_inline ‘memcpy’: function attribute mismatch \__NTH (memcpy (void *\__restrict \__dest, const void *\__restrict \__src,
  See https://bugzilla.mozilla.org/show_bug.cgi?id=1422254
  Basically add `-U_FORTIFY_SOURCE` to CFLAGS and CXXFLAGS in mozconfig
  
- Compiler error: undefined reference to dlsym
  see https://askubuntu.com/questions/454443/how-do-i-deal-with-undefined-reference-to-dlopen-errors-while-compiling-and-us
  add `-Wl,--no-as-needed -ldl` to LDFLAGS in mozconfig

 
  
### 4. Make JS shell (optional)
  ```
  cd js/src
  autoconf2.13

  # This name should end with "_DBG.OBJ" to make the version control system ignore it.
  mkdir build_DBG.OBJ
  cd build_DBG.OBJ
  ../configure --enable-debug --disable-optimize
  # Use "mozmake" on Windows
  make
  ```
  
## List of Vulnerabilities:

### CVE-2018-12387
  
  type: Info Leak
  
  FF version: < 61.0
  
  **Crash?** :white_check_mark:  
  
  **exploitation?** leak of XUL base address, stack and heap addresses
  
### CVE-2019-9791

  type: Type confusion 
  
  FF version: < 66.0  
  
  **Crash?** :white_check_mark:  
  
  **exploitation?** r/w primitive

### CVE-2019-9810

  type: Heap overflow 
  
  FF version: < 66.0.1  
  
  **Crash?** :white_check_mark:  
  
  **exploitation?** -
  
### CVE-2019-9813   

  type: Type confusion   
  
  FF version: < 66.0.1  
  
  **Crash?** :white_check_mark:  
  
  **exploitation?** -

### CVE-2019-11701
  type: Type confusion   
  
  FF version: 66.0.3  
  
  **Crash?** :white_check_mark:  
  
  **exploitation?** r/w primitive, control hijack
  

          
